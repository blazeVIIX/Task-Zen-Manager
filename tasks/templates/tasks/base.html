{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ–Ω–µ–¥–∂–µ—Ä –ó–∞–¥–∞—á</title>
    <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Noto+Sans+JP:wght@300;400&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'tasks/style.css' %}">
</head>
<body class="bg-light">
    <div id="sakura-container"></div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container">
        <a class="navbar-brand" href="{% url 'task_list' %}">Task Zen Manager</a>
        <div class="navbar-nav ms-auto">
            {% if user.is_authenticated %}
                <span class="nav-item nav-link text-light me-3">–ü—Ä–∏–≤–µ—Ç, {{ user.username }}!</span>
                <form action="{% url 'logout' %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-light btn-sm">–í—ã–π—Ç–∏</button>
                </form>
            {% else %}
                <a class="nav-item nav-link" href="{% url 'login' %}">–í—Ö–æ–¥</a>
                <a class="nav-item nav-link text-white fw-bold" href="{% url 'register' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}
        </div>
    </div>
</nav>

    <div class="container">
        {% block content %}
        {% endblock %}
    </div>

<audio id="success-sound" preload="auto">
    <source src="{% static 'tasks/sounds/success.mp3' %}" type="audio/mpeg">
</audio>

<script>
function createPetal() {
    const container = document.getElementById('sakura-container');
    const petal = document.createElement('span');
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–µ–ø–µ—Å—Ç–∫–∞
    const size = Math.random() * 10 + 10 + 'px';
    petal.style.width = size;
    petal.style.height = size;
    petal.style.left = Math.random() * 100 + 'vw';
    petal.style.animationDuration = Math.random() * 3 + 7 + 's'; // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è
    petal.style.opacity = Math.random() * 0.5 + 0.3;
    
    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–∏–º–≤–æ–ª –ª–µ–ø–µ—Å—Ç–∫–∞ (–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —Ä–æ–∑–æ–≤—ã–π –∫—Ä—É–≥)
    petal.innerHTML = 'üå∏';
    petal.classList.add('petal');
    
    container.appendChild(petal);
    
    // –£–¥–∞–ª—è–µ–º –ª–µ–ø–µ—Å—Ç–æ–∫ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
        petal.remove();
    }, 10000);
}

// –°–æ–∑–¥–∞–µ–º –ª–µ–ø–µ—Å—Ç–æ–∫ –∫–∞–∂–¥—ã–µ 400–º—Å
setInterval(createPetal, 400);
</script>

<style>
.petal {
    position: fixed;
    top: -50px;
    user-select: none;
    pointer-events: none;
    z-index: 9999;
    animation-name: fall;
    animation-timing-function: linear;
}

@keyframes fall {
    0% {
        transform: translateY(0) rotate(0deg) translateX(0);
    }
    100% {
        transform: translateY(110vh) rotate(720deg) translateX(100px);
    }
}
</style>

<script>
    // 1. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ "–ì–æ—Ç–æ–≤–æ", —Å—Ç–∞–≤–∏–º –º–µ—Ç–∫—É –≤ –ø–∞–º—è—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞
    document.querySelectorAll('a[href*="toggle"]').forEach(link => {
        link.addEventListener('click', () => {
            localStorage.setItem('task_done_sound', 'true');
        });
    });

    // 2. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º: –µ—Å–ª–∏ –º–µ—Ç–∫–∞ –µ—Å—Ç—å ‚Äî –∏–≥—Ä–∞–µ–º –∑–≤—É–∫
    window.addEventListener('load', () => {
        if (localStorage.getItem('task_done_sound') === 'true') {
            const audio = document.getElementById('success-sound');
            if (audio) {
                audio.currentTime = 0;
                audio.play();
            }
            // –°—Ç–∏—Ä–∞–µ–º –º–µ—Ç–∫—É, —á—Ç–æ–±—ã –∑–≤—É–∫ –Ω–µ –æ—Ä–∞–ª –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
            localStorage.removeItem('task_done_sound');
        }
    });
</script>

</body>
</html>